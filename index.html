<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>VIRAL NEWS</title>
<meta name="description" content="Viral News – Latest headlines from all categories">

<style>
body {
  font-family: Arial, sans-serif;
  background: #0a1d3f; /* Navy-blue background */
  color: #fff;
  margin: 0;
  padding: 0;
}
header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 15px 20px;
  background: #081737; 
  position: sticky;
  top: 0;
  z-index: 1000;
}
header h1 {
  margin: 0;
  font-size: 26px;
  color: #fff;
}
.menu-icon {
  cursor: pointer;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  width: 25px;
  height: 20px;
}
.menu-icon div {
  height: 3px;
  background: #fff;
  border-radius: 2px;
}
#categories-menu {
  position: fixed;
  top: 0;
  left: 0;
  width: 250px;
  height: 100%;
  background: #1a2c5b;
  padding: 20px;
  transform: translateX(-260px);
  transition: transform 0.3s ease;
  overflow-y: auto;
  z-index: 999;
}
#categories-menu.active {
  transform: translateX(0);
}
#categories-menu h2 {
  font-size: 18px;
  margin-bottom: 15px;
}
#categories-menu a {
  display: block;
  text-decoration: none;
  color: #fff;
  padding: 10px 0;
  font-size: 14px;
}
#categories-menu a:hover {
  color: #ffcc00;
}
#news-container {
  max-width: 900px;
  margin: 20px auto;
  padding: 0 20px;
}
.category-section {
  margin-bottom: 40px;
}
.category-section h2 {
  font-size: 20px;
  border-bottom: 2px solid #444;
  padding-bottom: 5px;
  margin-bottom: 15px;
}
.article-item {
  background: #0f264f;
  margin-bottom: 10px;
  padding: 12px;
  border-radius: 6px;
}
.article-item a {
  color: #fff;
  text-decoration: none;
  font-weight: bold;
  display: block;
}
.article-item a:hover {
  color: #ffcc00;
}
.article-time {
  font-size: 12px;
  color: #ccc;
  margin-top: 3px;
}
.back-home {
  display: inline-block;
  margin-bottom: 15px;
  font-size: 14px;
  color: #ffcc00;
  cursor: pointer;
}
</style>
</head>

<body>

<header>
  <div class="menu-icon" id="menu-toggle">
    <div></div>
    <div></div>
    <div></div>
  </div>
  <h1>VIRAL NEWS</h1>
</header>

<div id="categories-menu">
  <h2>Categories</h2>
  <a href="#" data-category="breaking">breaking</a>
  <a href="#" data-category="trending">trending</a>
  <a href="#" data-category="top headlines">top headlines</a>
  <a href="#" data-category="General News">General News</a>
  <a href="#" data-category="World News">World News</a>
  <a href="#" data-category="Politics">Politics</a>
  <a href="#" data-category="Technology">Technology</a>
  <a href="#" data-category="Sports">Sports</a>
  <a href="#" data-category="Health & Fitness">Health & Fitness</a>
  <a href="#" data-category="Entertainment">Entertainment</a>
</div>

<div id="news-container">Loading…</div>

<script>
const menuToggle = document.getElementById("menu-toggle");
const categoriesMenu = document.getElementById("categories-menu");
menuToggle.addEventListener("click", () => {
  categoriesMenu.classList.toggle("active");
});

// Close menu when clicking outside
document.addEventListener("click", (e) => {
  if (!categoriesMenu.contains(e.target) && !menuToggle.contains(e.target)) {
    categoriesMenu.classList.remove("active");
  }
});

// Helper: format time (23 m, 5 h)
function formatTime(published_at) {
  const pubDate = new Date(published_at);
  const diffMs = Date.now() - pubDate.getTime();
  const diffMins = Math.floor(diffMs / 60000);
  if (diffMins < 60) return `${diffMins} m`;
  const diffHrs = Math.floor(diffMins / 60);
  if (diffHrs < 24) return `${diffHrs} h`;
  const diffDays = Math.floor(diffHrs / 24);
  return `${diffDays} d`;
}

let allArticles = [];
let currentCategory = null;

// We only want highlighted_articles content to appear.
// Your backend already merges sources, but we will FILTER to highlighted_articles only.
function isHighlightedArticle(a) {
  // Supports common backend fields: table, source_table, origin, is_highlighted
  const t = (a.table || a.source_table || a.origin || "").toString().toLowerCase();
  if (t.includes("highlighted")) return true;
  if (a.is_highlighted === true) return true;
  if (a.highlighted === true) return true;
  // Fallback: if backend already returns only highlighted, keep it.
  return true;
}

function sanitizeTitle(t) {
  return (t || "").toString().replace(/[\[\]\*\<\>\"\'\`]/g, "").trim();
}

const CATEGORY_ORDER = [
  "breaking",
  "trending",
  "top headlines",
  "General News",
  "World News",
  "Politics",
  "Technology",
  "Sports",
  "Health & Fitness",
  "Entertainment"
];

// Fetch articles from backend
async function loadArticles(category = null) {
  const container = document.getElementById("news-container");
  container.innerHTML = "";
  currentCategory = category;

  try {
    const res = await fetch("https://viral-news-backend-3.onrender.com/articles/");
    const articles = await res.json();

    // Map articles to clean format (and filter to highlighted)
    allArticles = (articles || [])
      .filter(isHighlightedArticle)
      .filter(a => a.title)
      .map(a => ({
        id: a.id,
        title: sanitizeTitle(a.title),
        category: (a.category || "General News"),
        published_at: a.published_at
      }));

    // Sort newest -> oldest once
    allArticles.sort((a, b) => new Date(b.published_at) - new Date(a.published_at));

    if (!category) {
      displayFrontPage();
    } else {
      displayCategory(category);
    }
  } catch (err) {
    container.innerHTML = "Failed to load articles. Please try again later.";
    console.error(err);
  }
}

// Display front page: 10 categories (5 each) + More for you (everything else not already shown)
function displayFrontPage() {
  const container = document.getElementById("news-container");
  container.innerHTML = "";

  const shownIds = new Set();

  // Render ordered categories (5 each)
  CATEGORY_ORDER.forEach(cat => {
    const catArticles = allArticles.filter(a => a.category === cat);
    const top5 = catArticles.slice(0, 5);

    if (top5.length > 0) {
      const section = document.createElement("div");
      section.className = "category-section";
      section.innerHTML = `<h2>${cat}</h2>`;

      top5.forEach(a => {
        shownIds.add(a.id);
        const div = document.createElement("div");
        div.className = "article-item";
        div.innerHTML = `
          <a href="articles.html?id=${a.id}">${a.title}</a>
          <div class="article-time">${formatTime(a.published_at)}</div>
        `;
        section.appendChild(div);
      });

      container.appendChild(section);
    }
  });

  // More for you: everything not shown above (newest -> oldest)
  const moreForYou = allArticles.filter(a => !shownIds.has(a.id));

  const moreSection = document.createElement("div");
  moreSection.className = "category-section";
  moreSection.innerHTML = `<h2>More for you</h2>`;

  if (moreForYou.length === 0) {
    const empty = document.createElement("div");
    empty.className = "article-item";
    empty.innerHTML = `<div>No more articles yet.</div>`;
    moreSection.appendChild(empty);
  } else {
    moreForYou.forEach(a => {
      const div = document.createElement("div");
      div.className = "article-item";
      div.innerHTML = `
        <a href="articles.html?id=${a.id}">${a.title}</a>
        <div class="article-time">${formatTime(a.published_at)}</div>
      `;
      moreSection.appendChild(div);
    });
  }

  container.appendChild(moreSection);
}

// Display single category (from menu)
function displayCategory(category) {
  const container = document.getElementById("news-container");
  container.innerHTML = "";
  const catArticles = allArticles.filter(a => a.category === category);

  // Back to home button
  const backBtn = document.createElement("div");
  backBtn.className = "back-home";
  backBtn.textContent = "← Back to Home";
  backBtn.onclick = () => loadArticles();
  container.appendChild(backBtn);

  const section = document.createElement("div");
  section.className = "category-section";
  section.innerHTML = `<h2>${category}</h2>`;

  if (catArticles.length === 0) {
    const empty = document.createElement("div");
    empty.className = "article-item";
    empty.innerHTML = `<div>No articles in this category yet.</div>`;
    section.appendChild(empty);
  } else {
    catArticles.forEach(a => {
      const div = document.createElement("div");
      div.className = "article-item";
      div.innerHTML = `
        <a href="articles.html?id=${a.id}">${a.title}</a>
        <div class="article-time">${formatTime(a.published_at)}</div>
      `;
      section.appendChild(div);
    });
  }

  container.appendChild(section);
}

// Category menu click
document.querySelectorAll("#categories-menu a").forEach(link => {
  link.addEventListener("click", e => {
    e.preventDefault();
    const cat = e.target.dataset.category;
    loadArticles(cat);
    categoriesMenu.classList.remove("active");
  });
});

// Initial load
loadArticles();
</script>

</body>
</html>
