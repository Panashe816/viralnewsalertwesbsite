<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>VIRAL NEWS</title>

<meta name="description" content="Viral News – Latest headlines from all categories" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link rel="canonical" href="https://viralnewsalert.com/" />

<!-- Open Graph -->
<meta property="og:title" content="Viral News" />
<meta property="og:description" content="Latest headlines from all categories." />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://viralnewsalert.com/" />

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Viral News" />
<meta name="twitter:description" content="Latest headlines from all categories." />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" href="/favicon.ico">
<link rel="manifest" href="/site.webmanifest">
<meta name="theme-color" content="#081737">

<style>
  :root{
    --bg:#0a1d3f;
    --bg2:#081737;
    --panel:#0f264f;
    --line:#334a7a;
    --text:#ffffff;
    --muted:#cfd8ea;
    --accent:#ffcc00;
    --danger:#ff6b6b;
    --shadow: 0 10px 24px rgba(0,0,0,.25);
    --radius: 12px;
  }

  *{ box-sizing: border-box; }
  body{
    margin:0;
    font-family: Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
  }

  header{
    background: var(--bg2);
    position: sticky;
    top:0;
    z-index:1000;
    border-bottom: 1px solid rgba(255,255,255,.08);
  }

  .top-row{
    display:flex;
    align-items:center;
    justify-content:center;
    padding: 12px 18px 10px;
    position: relative;
  }
  .brand{
    margin:0;
    font-size: 22px;
    letter-spacing: .7px;
    font-weight: 800;
  }

  /* ✅ Left hamburger */
  .hamburger{
    position:absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    width: 42px;
    height: 38px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.05);
    color:#fff;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow: 0 6px 16px rgba(0,0,0,.18);
  }
  .hamburger:hover{ border-color: rgba(255,204,0,.35); color: var(--accent); }
  .hamburger:active{ transform: translateY(-50%) scale(.98); }
  .hamburger .bars{
    width: 18px;
    height: 14px;
    position: relative;
  }
  .hamburger .bars span{
    position:absolute;
    left:0;
    right:0;
    height:2px;
    background: currentColor;
    border-radius: 999px;
    opacity:.95;
  }
  .hamburger .bars span:nth-child(1){ top:0; }
  .hamburger .bars span:nth-child(2){ top:6px; }
  .hamburger .bars span:nth-child(3){ top:12px; }

  /* ✅ Dropdown menu (About/Contact/Privacy ONLY) */
  .menu{
    position:absolute;
    left: 10px;
    top: calc(100% + 10px);
    width: 220px;
    background: var(--panel);
    border: 1px solid rgba(255,255,255,.10);
    border-radius: 14px;
    box-shadow: var(--shadow);
    overflow:hidden;
    display:none;
    z-index: 2000;
  }
  .menu a{
    display:flex;
    align-items:center;
    padding: 12px 12px;
    color:#fff;
    text-decoration:none;
    font-weight: 900;
    font-size: 13px;
    border-bottom: 1px solid rgba(255,255,255,.07);
  }
  .menu a:last-child{ border-bottom:none; }
  .menu a:hover{
    background: rgba(255,204,0,.10);
    color: var(--accent);
  }

  /* ✅ Top-right auth buttons */
  .auth-area{
    position:absolute;
    right: 14px;
    top: 50%;
    transform: translateY(-50%);
    display:flex;
    align-items:center;
    gap: 10px;
  }
  .auth-btn{
    display:inline-flex;
    align-items:center;
    gap: 8px;
    padding: 8px 12px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,.18);
    background: rgba(255,255,255,.06);
    color:#fff;
    text-decoration:none;
    font-size: 13px;
    font-weight: 900;
    cursor:pointer;
    user-select:none;
    white-space: nowrap;
  }
  .auth-btn:hover{
    border-color: rgba(255,204,0,.35);
    color: var(--accent);
  }
  .auth-btn.primary{
    background: rgba(255,204,0,.14);
    border-color: rgba(255,204,0,.28);
    color: var(--accent);
  }

  /* ✅ Account modal */
  .modal-overlay{
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.55);
    display: none;
    align-items: center;
    justify-content: center;
    padding: 18px;
    z-index: 9999;
  }
  .modal{
    width: 100%;
    max-width: 420px;
    background: var(--panel);
    border: 1px solid rgba(255,255,255,.10);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow: hidden;
  }
  .modal-head{
    display:flex;
    align-items:center;
    justify-content: space-between;
    padding: 12px 14px;
    background: rgba(255,255,255,.03);
    border-bottom: 1px solid rgba(255,255,255,.08);
  }
  .modal-title{
    margin:0;
    font-size: 14px;
    font-weight: 900;
    letter-spacing: .3px;
  }
  .modal-close{
    border: none;
    background: transparent;
    color: #fff;
    font-size: 22px;
    cursor: pointer;
    line-height: 1;
    padding: 0 6px;
  }
  .modal-body{
    padding: 14px;
  }
  .field{
    margin-bottom: 10px;
    color: var(--muted);
    font-size: 13px;
  }
  .field strong{
    color:#fff;
  }

  .catbar{
    display:flex;
    gap: 10px;
    overflow-x: auto;
    padding: 10px 12px 12px;
    border-top: 1px solid rgba(255,255,255,.06);
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
  }
  .catbar::-webkit-scrollbar{ height: 8px; }
  .catbar::-webkit-scrollbar-thumb{
    background: rgba(255,255,255,.18);
    border-radius: 999px;
  }

  .catbtn{
    scroll-snap-align: start;
    flex: 0 0 auto;
    display:inline-flex;
    align-items:center;
    gap: 8px;
    padding: 9px 12px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,.12);
    background: rgba(255,255,255,.04);
    color:#fff;
    text-decoration:none;
    font-size: 13px;
    font-weight: 800;
    user-select:none;
    white-space: nowrap;
  }
  .catbtn:hover{ border-color: rgba(255,204,0,.35); color: var(--accent); }
  .catbtn.active{
    background: rgba(255,204,0,.16);
    border-color: rgba(255,204,0,.30);
    color: var(--accent);
  }

  #news-container{
    max-width: 1120px;
    margin: 18px auto 70px;
    padding: 0 16px;
  }

  .section-title{
    display:flex;
    align-items:center;
    gap:10px;
    margin: 26px 0 14px;
  }
  .section-title .bar{
    width:4px; height:18px;
    background: var(--accent);
    border-radius: 10px;
  }
  .section-title h2{
    margin:0;
    font-size: 18px;
    letter-spacing: .3px;
  }
  .section-title .viewall{
    margin-left:auto;
    color: var(--accent);
    font-size: 13px;
    text-decoration:none;
  }
  .section-title .viewall:hover{ text-decoration: underline; }

  .card{
    background: var(--panel);
    border-radius: var(--radius);
    overflow:hidden;
    box-shadow: var(--shadow);
    border: 1px solid rgba(255,255,255,.06);
  }

  .hero-grid{
    display:grid;
    grid-template-columns: 1.35fr .65fr;
    gap: 14px;
    margin-top: 12px;
  }
  .hero-main{ display:flex; flex-direction:column; }
  .hero-main .img{
    width:100%;
    aspect-ratio: 16/9;
    background: linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
    position:relative;
    overflow:hidden;
  }
  .hero-main .img img{ width:100%; height:100%; object-fit:cover; display:block; }
  .hero-main .body{ padding: 14px 14px 12px; }

  .kicker{
    display:flex;
    gap:10px;
    align-items:center;
    margin-bottom: 8px;
    color: var(--muted);
    font-size: 12px;
  }
  .chip{
    background: rgba(255,204,0,.16);
    color: var(--accent);
    border: 1px solid rgba(255,204,0,.25);
    padding: 3px 8px;
    border-radius: 999px;
    font-weight: 800;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing:.4px;
  }
  .hero-title{
    font-size: 22px;
    margin: 0 0 6px;
    line-height: 1.25;
  }
  .hero-title a{ color:#fff; text-decoration:none; }
  .hero-title a:hover{ color: var(--accent); }
  .hero-desc{
    margin: 0;
    color: var(--muted);
    font-size: 14px;
    line-height: 1.5;
  }

  .hero-side{
    display:flex;
    flex-direction:column;
    gap: 10px;
  }
  .side-item{
    display:grid;
    grid-template-columns: 86px 1fr;
    gap:10px;
    padding: 10px;
    background: var(--panel);
    border-radius: var(--radius);
    border: 1px solid rgba(255,255,255,.06);
  }
  .side-thumb{
    width:86px;
    height:64px;
    border-radius: 10px;
    overflow:hidden;
    background: rgba(255,255,255,.06);
  }
  .side-thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
  .side-title{
    margin:0;
    font-size: 13px;
    line-height: 1.25;
    font-weight: 900;
  }
  .side-title a{ color:#fff; text-decoration:none; }
  .side-title a:hover{ color: var(--accent); }
  .meta{
    margin-top: 6px;
    font-size: 12px;
    color: var(--muted);
  }

  .strip{ display:grid; grid-template-columns: 1fr; gap: 10px; }
  .strip-item{
    display:flex;
    align-items:flex-start;
    padding: 12px;
    background: rgba(255,255,255,.03);
    border: 1px solid rgba(255,255,255,.06);
    border-radius: var(--radius);
  }
  .strip-item a{
    color:#fff;
    text-decoration:none;
    font-weight: 900;
    line-height: 1.25;
  }
  .strip-item a:hover{ color: var(--accent); }
  .strip-meta{
    color: var(--muted);
    font-size: 12px;
    margin-top: 4px;
  }

  .cat-grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
  }
  .cat-block{ display:flex; flex-direction:column; gap: 10px; }

  .lead{
    display:grid;
    grid-template-columns: 120px 1fr;
    gap: 12px;
    padding: 12px;
    background: rgba(255,255,255,.03);
    border: 1px solid rgba(255,255,255,.06);
    border-radius: var(--radius);
  }
  .lead .thumb{
    width:120px;
    height:84px;
    border-radius: 12px;
    overflow:hidden;
    background: rgba(255,255,255,.06);
  }
  .lead .thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
  .lead h3{ margin:0; font-size: 14px; line-height: 1.25; }
  .lead h3 a{ color:#fff; text-decoration:none; font-weight: 900; }
  .lead h3 a:hover{ color: var(--accent); }

  .list{ display:flex; flex-direction:column; gap: 8px; }
  .list-row{
    display:flex;
    gap: 10px;
    align-items:center;
    padding: 10px 12px;
    background: rgba(255,255,255,.02);
    border: 1px solid rgba(255,255,255,.05);
    border-radius: 12px;
  }
  .list-row .mini{
    width:56px;
    height:42px;
    border-radius: 10px;
    background: rgba(255,255,255,.06);
    overflow:hidden;
    flex: 0 0 auto;
  }
  .list-row .mini img{ width:100%; height:100%; object-fit:cover; display:block; }
  .list-row a{
    color:#fff;
    text-decoration:none;
    font-weight: 900;
    font-size: 13px;
    line-height: 1.25;
    display:block;
  }
  .list-row a:hover{ color: var(--accent); }
  .list-row .time{
    margin-left:auto;
    color: var(--muted);
    font-size: 12px;
    flex: 0 0 auto;
  }

  .rail{
    display:flex;
    gap: 12px;
    overflow-x: auto;
    padding-bottom: 6px;
    scroll-snap-type: x mandatory;
  }
  .rail::-webkit-scrollbar{ height: 8px; }
  .rail::-webkit-scrollbar-thumb{
    background: rgba(255,255,255,.18);
    border-radius: 999px;
  }
  .rail-card{
    min-width: 260px;
    max-width: 260px;
    scroll-snap-align: start;
    background: rgba(255,255,255,.03);
    border: 1px solid rgba(255,255,255,.06);
    border-radius: var(--radius);
    overflow:hidden;
  }
  .rail-card .thumb{
    width:100%;
    height: 150px;
    background: rgba(255,255,255,.06);
    overflow:hidden;
  }
  .rail-card .thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
  .rail-card .body{ padding: 10px 12px 12px; }
  .rail-card .title{ margin:0; font-size: 14px; line-height: 1.25; }
  .rail-card .title a{
    color:#fff;
    text-decoration:none;
    font-weight: 900;
  }
  .rail-card .title a:hover{ color: var(--accent); }
  .rail-card .meta{ margin-top: 8px; font-size: 12px; color: var(--muted); }

  .text-only{
    display:flex;
    flex-direction:column;
    gap: 10px;
  }
  .text-only .row{
    padding: 12px;
    background: rgba(255,255,255,.03);
    border: 1px solid rgba(255,255,255,.06);
    border-radius: var(--radius);
  }
  .text-only .row a{
    color:#fff;
    text-decoration:none;
    font-weight: 900;
    line-height: 1.25;
  }
  .text-only .row a:hover{ color: var(--accent); }
  .text-only .meta{ margin-top: 6px; }

  .more-wrap{ margin-top: 10px; }
  .more-list{
    display:flex;
    flex-direction:column;
    gap: 10px;
  }
  .more-item{
    display:grid;
    grid-template-columns: 92px 1fr;
    gap: 12px;
    padding: 12px;
    background: rgba(255,255,255,.03);
    border: 1px solid rgba(255,255,255,.06);
    border-radius: var(--radius);
  }
  .more-thumb{
    width:92px;
    height:72px;
    border-radius: 12px;
    background: rgba(255,255,255,.06);
    overflow:hidden;
  }
  .more-thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
  .more-item a{
    color:#fff;
    text-decoration:none;
    font-weight: 900;
    line-height: 1.25;
    display:block;
  }
  .more-item a:hover{ color: var(--accent); }
  .more-meta{ margin-top: 6px; color: var(--muted); font-size: 12px; }

  .load-hint{
    text-align:center;
    margin: 16px 0 0;
    color: var(--muted);
    font-size: 12px;
  }

  .error-box{
    background: #331a1a;
    border: 1px solid var(--danger);
    padding: 12px;
    border-radius: var(--radius);
  }

  /* ✅ Footer exists but is hidden on homepage (menu replaces it) */
  footer{
    display:none;
    margin-top: 40px;
    padding: 24px 0 50px;
    text-align:center;
    color: var(--muted);
    font-size: 13px;
  }
  footer a{
    color: var(--accent);
    text-decoration:none;
    margin: 0 10px;
    font-weight: 800;
  }
  footer a:hover{ text-decoration: underline; }


  /* ================================
     DESKTOP: Header Search & Refresh
     ================================ */
  .header-actions{
    position:absolute;
    right: 140px;
    top: 50%;
    transform: translateY(-50%);
    display:flex;
    gap: 10px;
  }
  .header-action-btn{
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding: 7px 12px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,.18);
    background: rgba(255,255,255,.06);
    color:#fff;
    font-size: 13px;
    font-weight: 800;
    cursor:pointer;
    user-select:none;
    white-space: nowrap;
  }
  .header-action-btn:hover{
    border-color: rgba(255,204,0,.35);
    color: var(--accent);
  }

  /* ================================
     MOBILE: Bottom Tab Bar
     ================================ */
  .mobile-tabbar{
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 60px;
    background: var(--bg2);
    border-top: 1px solid rgba(255,255,255,.1);
    display: none;
    z-index: 3000;
  }
  .mobile-tabbar .tabs{
    height: 100%;
    display: grid;
    grid-template-columns: repeat(4, 1fr);
  }
  .mobile-tab{
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    gap:4px;
    color: var(--muted);
    font-size: 11px;
    font-weight: 800;
    cursor:pointer;
    user-select:none;
  }
  .mobile-tab.active,
  .mobile-tab:hover{
    color: var(--accent);
  }

  /* ================================
     MOBILE: Bottom Sheet (Search / Settings)
     ================================ */
  .bottom-sheet-overlay{
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.55);
    display:none;
    align-items:flex-end;
    z-index: 4000;
  }
  .bottom-sheet{
    width:100%;
    background: var(--panel);
    border-radius: 18px 18px 0 0;
    padding: 14px;
    box-shadow: var(--shadow);
  }
  .sheet-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom: 10px;
  }
  .sheet-title{
    font-size: 14px;
    font-weight: 900;
  }
  .sheet-close{
    border:none;
    background: transparent;
    color:#fff;
    font-size: 22px;
    cursor:pointer;
    line-height: 1;
    padding: 0 6px;
  }

  /* Mobile search UI */
  .mobile-search-input{
    width:100%;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,.15);
    background: rgba(255,255,255,.05);
    color:#fff;
    font-size: 14px;
    outline: none;
  }
  .mobile-search-results{
    margin-top: 10px;
    display:flex;
    flex-direction:column;
    gap: 8px;
    max-height: 46vh;
    overflow:auto;
    padding-right: 2px;
  }
  .mobile-search-results .row{
    padding: 12px;
    background: rgba(255,255,255,.03);
    border: 1px solid rgba(255,255,255,.06);
    border-radius: var(--radius);
  }
  .mobile-search-results .row a{
    color:#fff;
    text-decoration:none;
    font-weight: 900;
    line-height: 1.25;
  }
  .mobile-search-results .row a:hover{ color: var(--accent); }

  /* Mobile settings UI */
  .mobile-settings{
    display:flex;
    flex-direction:column;
    gap: 8px;
  }
  .mobile-settings .auth-btn{
    width: 100%;
    justify-content:center;
  }
  .mobile-settings a{
    display:block;
    padding: 12px;
    border-radius: 12px;
    color:#fff;
    text-decoration:none;
    font-weight: 900;
    border: 1px solid rgba(255,255,255,.08);
    background: rgba(255,255,255,.03);
  }
  .mobile-settings a:hover{ color: var(--accent); }

  @media (max-width: 980px){
    .hero-grid{ grid-template-columns: 1fr; }
    .hero-side{ flex-direction: row; flex-wrap: wrap; }
    .side-item{ grid-template-columns: 70px 1fr; flex: 1 1 280px; }
  }
  @media (max-width: 760px){
    #news-container{ padding: 0 12px; }
    .brand{ font-size: 20px; }
    .auth-area{ right: 10px; }
    .auth-btn{ padding: 7px 10px; font-size: 12px; }

    /* ✅ ONLY CHANGE: categories become 1 column on mobile */
    .cat-grid{ grid-template-columns: 1fr; }

    /* ✅ FIX #1 (mobile only): remove hero summary */
    .hero-desc{ display:none; }

    /* ✅ FIX #2 (mobile only): prevent headline text overlapping thumbnail
       (your grid col is 70px, so thumbnail must also fit) */
    .side-thumb{ width:70px; height:52px; }
    .side-item{ grid-template-columns: 70px 1fr; }

    /* Hide desktop actions on mobile */
    .header-actions{ display:none; }

    /* Show bottom tab bar on mobile */
    .mobile-tabbar{ display:block; }
    body{ padding-bottom: 70px; }
  }
</style>
</head>

<body>

<header>
  <div class="top-row">
    <!-- ✅ Hamburger + dropdown -->
    <button class="hamburger" id="hamburger" type="button" aria-label="Menu" aria-haspopup="true" aria-expanded="false">
      <div class="bars" aria-hidden="true">
        <span></span><span></span><span></span>
      </div>
    </button>

    <div class="menu" id="menu">
      <a href="/about-us.html">About Us</a>
      <a href="/contact.html">Contact</a>
      <a href="/privacy-policy.html">Privacy Policy</a>
    </div>

    <h1 class="brand">VIRAL NEWS</h1>

    <!-- ✅ DESKTOP header actions (Search + Refresh) -->
    <div class="header-actions" id="header-actions">
      <button class="header-action-btn" id="btn-desktop-search" type="button">Search</button>
      <button class="header-action-btn" id="btn-desktop-refresh" type="button">Refresh</button>
    </div>

    <!-- ✅ Top-right auth buttons REMOVED -->
  </div>

  <nav class="catbar" id="catbar">
    <a class="catbtn active" href="/">Home</a>
    <a class="catbtn" href="/category/breaking.html">Breaking</a>
    <a class="catbtn" href="/category/trending.html">Trending</a>
    <a class="catbtn" href="/category/top-headlines.html">Top Headlines</a>
    <a class="catbtn" href="/category/general.html">General News</a>
    <a class="catbtn" href="/category/world.html">World News</a>
    <a class="catbtn" href="/category/politics.html">Politics</a>
    <a class="catbtn" href="/category/technology.html">Technology</a>
    <a class="catbtn" href="/category/sports.html">Sports</a>
    <a class="catbtn" href="/category/health-fitness.html">Health & Fitness</a>
    <a class="catbtn" href="/category/entertainment.html">Entertainment</a>
  </nav>
</header>

<!-- ✅ My Account modal (email + logout) -->
<div class="modal-overlay" id="account-modal">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="account-title">
    <div class="modal-head">
      <h3 class="modal-title" id="account-title">My Account</h3>
      <button class="modal-close" id="account-close" aria-label="Close">&times;</button>
    </div>
    <div class="modal-body">
      <div class="field">Signed in as: <strong id="account-email">—</strong></div>
      <button class="auth-btn" id="btn-logout" type="button" style="border-color: rgba(255,107,107,.45); color: var(--danger);">
        Logout
      </button>
    </div>
  </div>
</div>

<div id="news-container">Loading…</div>

<!-- ✅ MOBILE bottom tab bar -->
<div class="mobile-tabbar" id="mobile-tabbar">
  <div class="tabs">
    <div class="mobile-tab active" id="tab-home" role="button" aria-label="Home">
      <div>Home</div>
    </div>
    <div class="mobile-tab" id="tab-refresh" role="button" aria-label="Refresh">
      <div>Refresh</div>
    </div>
    <div class="mobile-tab" id="tab-search" role="button" aria-label="Search">
      <div>Search</div>
    </div>
    <div class="mobile-tab" id="tab-settings" role="button" aria-label="Settings">
      <div>Settings</div>
    </div>
  </div>
</div>

<!-- ✅ MOBILE bottom sheet overlay (Search / Settings) -->
<div class="bottom-sheet-overlay" id="sheet-overlay" aria-hidden="true">
  <div class="bottom-sheet" role="dialog" aria-modal="true" aria-labelledby="sheet-title">
    <div class="sheet-header">
      <div class="sheet-title" id="sheet-title">Menu</div>
      <button class="sheet-close" id="sheet-close" aria-label="Close">&times;</button>
    </div>

    <!-- Search panel -->
    <div id="sheet-search" style="display:none;">
      <input class="mobile-search-input" id="mobile-search-input" type="search" placeholder="Search headlines..." autocomplete="off" />
      <div class="mobile-search-results" id="mobile-search-results"></div>
    </div>

    <!-- Settings panel -->
    <div id="sheet-settings" style="display:none;">
      <div class="mobile-settings">
        <!-- ✅ Sign in / My Account buttons REMOVED from Settings -->

        <a href="/about-us.html">About Us</a>
        <a href="/contact.html">Contact</a>
        <a href="/privacy-policy.html">Privacy Policy</a>
      </div>
    </div>
  </div>
</div>

<!-- Hidden footer (prevents flash + sitemap never shown) -->
<footer>
  <a href="/about-us.html">About Us</a>
  <a href="/contact.html">Contact</a>
  <a href="/privacy-policy.html">Privacy Policy</a>
  <a href="/sitemap.xml">Sitemap</a>
</footer>

<script>
(function(){
  var API_BASE = "https://viral-news-backend-2.onrender.com";
  var HOMEPAGE_URL = API_BASE + "/homepage";

  var HOME_CACHE_KEY = "vn_homepage_cache_v1";
  var HOME_CACHE_TTL = 60 * 1000;

  // ✅ Auth storage keys
  var ACCESS_KEY = "access_token";
  var USER_EMAIL_KEY = "user_email";

  function escapeHtml(s){
    s = (s || "").toString();
    return s
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  }

  function stripHtml(s){
    return (s || "").toString().replace(/<[^>]*>/g, " ").replace(/\s+/g, " ").trim();
  }

  function formatTime(dt){
    var d = new Date(dt);
    if (isNaN(d.getTime())) return "";
    var diffMs = Date.now() - d.getTime();
    var mins = Math.floor(diffMs / 60000);
    if (mins < 1) return "now";
    if (mins < 60) return mins + "m";
    var hrs = Math.floor(mins / 60);
    if (hrs < 24) return hrs + "h";
    var days = Math.floor(hrs / 24);
    return days + "d";
  }

  function safeTime(a){ return a.published_at || a.created_at || ""; }
  function hasImage(a){ return !!((a.image_url || "").trim()); }

  function optimizeImg(url){
    if (!url) return "";
    var u = String(url);
    if (u.indexOf("images.pexels.com") !== -1){
      var hasQ = u.indexOf("?") !== -1;
      return u + (hasQ ? "&" : "?") + "auto=compress&cs=tinysrgb&w=900";
    }
    return u;
  }

  function pickImage(a){
    var img = (a.image_url || "").trim();
    return img ? optimizeImg(img) : null;
  }

  function slugify(s){
    s = (s || "").toString().toLowerCase();
    s = s.replace(/&/g, " and ");
    s = s.replace(/[^a-z0-9]+/g, "-");
    s = s.replace(/-+/g, "-").replace(/^-|-$/g, "");
    return s || "story";
  }

  // ✅ FIX: correct GitHub Pages project path
  function basePath(){
    var p = window.location.pathname || "";
    return (p.indexOf("/viralnewsalertwebsite/") !== -1) ? "/viralnewsalertwebsite" : "";
  }

  function linkToArticle(a){
    return basePath() + "/articles.html?id=" + encodeURIComponent(a.id);
  }

  function viewAllLink(href){
    return '<a class="viewall" href="' + href + '">View all</a>';
  }

  function sectionHeader(title, viewAllHref){
    var viewAll = viewAllHref ? viewAllLink(viewAllHref) : "";
    return '' +
      '<div class="section-title">' +
        '<div class="bar"></div>' +
        '<h2>' + escapeHtml(title) + '</h2>' +
        viewAll +
      '</div>';
  }

  function take(arr, n){ return (arr || []).slice(0, n); }

  function sortNewestFirst(arr){
    arr = (arr || []).slice();
    arr.sort(function(a,b){
      var da = new Date(safeTime(a)).getTime() || 0;
      var db = new Date(safeTime(b)).getTime() || 0;
      return db - da;
    });
    return arr;
  }

  function pickTopWithImages(items, count){
    items = sortNewestFirst(items || []);
    var withImg = [];
    for (var i=0;i<items.length;i++){
      if (hasImage(items[i])) withImg.push(items[i]);
      if (withImg.length >= count) break;
    }
    return withImg;
  }

  function pickFirstWithImage(items){
    items = sortNewestFirst(items || []);
    for (var i=0;i<items.length;i++){
      if (hasImage(items[i])) return items[i];
    }
    return items.length ? items[0] : null;
  }

  function readHomeCache(){
    try{
      var raw = localStorage.getItem(HOME_CACHE_KEY);
      if (!raw) return null;
      var obj = JSON.parse(raw);
      if (!obj || !obj.t || !obj.data) return null;
      if (Date.now() - obj.t > HOME_CACHE_TTL) return null;
      return obj.data;
    }catch(e){
      return null;
    }
  }

  function writeHomeCache(data){
    try{
      localStorage.setItem(HOME_CACHE_KEY, JSON.stringify({ t: Date.now(), data: data }));
    }catch(e){}
  }

  function fetchWithTimeout(url, ms){
    return new Promise(function(resolve, reject){
      var timer = setTimeout(function(){
        reject(new Error("Request timed out after " + ms + "ms"));
      }, ms);

      fetch(url, { cache: "default" })
        .then(function(res){ clearTimeout(timer); resolve(res); })
        .catch(function(err){ clearTimeout(timer); reject(err); });
    });
  }

  function fetchJsonWithRetry(url, timeoutMs, retries){
    retries = retries || 0;

    return fetchWithTimeout(url, timeoutMs).then(function(res){
      if (!res.ok){
        if ((res.status === 503 || res.status === 504) && retries < 1){
          return new Promise(function(r){ setTimeout(r, 1200); })
            .then(function(){ return fetchJsonWithRetry(url, timeoutMs, retries + 1); });
        }
        throw new Error("HTTP " + res.status);
      }
      return res.json();
    }).catch(function(err){
      if (retries < 1){
        return new Promise(function(r){ setTimeout(r, 1200); })
          .then(function(){ return fetchJsonWithRetry(url, timeoutMs, retries + 1); });
      }
      throw err;
    });
  }

  function showError(msg){
    var c = document.getElementById("news-container");
    c.innerHTML = '<div class="error-box">Failed to load homepage.<br><span style="color:var(--muted);font-size:12px;">' + escapeHtml(msg) + '</span></div>';
  }

  function isValidHomepage(data){
    return !!(data && data.categories && data.all);
  }

  var homepageData = null;

  // Infinite scroll
  var moreAll = [];
  var moreShown = 0;
  var MORE_BATCH = 12;
  var moreListEl = null;
  var moreLoadingEl = null;
  var loadingMore = false;
  var infiniteInstalled = false;

  function renderMoreBatch(){
    if (!moreListEl || loadingMore) return;
    loadingMore = true;

    var end = Math.min(moreAll.length, moreShown + MORE_BATCH);
    for (var i=moreShown;i<end;i++){
      var a = moreAll[i];
      var img = pickImage(a);
      var t = formatTime(safeTime(a));

      var div = document.createElement("div");
      div.className = "more-item";
      div.innerHTML =
        '<div class="more-thumb">' + (img ? '<img loading="lazy" decoding="async" width="184" height="144" src="' + img + '" alt="' + escapeHtml(a.title) + '">' : '') + '</div>' +
        '<div>' +
          '<a href="' + linkToArticle(a) + '">' + escapeHtml(a.title) + '</a>' +
          '<div class="more-meta">' + escapeHtml(t) + '</div>' +
        '</div>';

      moreListEl.appendChild(div);
    }

    moreShown = end;

    if (moreShown >= moreAll.length){
      moreLoadingEl.textContent = "No more articles.";
    } else {
      moreLoadingEl.textContent = "Scroll for more…";
    }

    loadingMore = false;
  }

  function installInfiniteScroll(){
    if (infiniteInstalled) return;
    infiniteInstalled = true;

    window.addEventListener("scroll", function(){
      if (!moreListEl) return;
      if (moreShown >= moreAll.length) return;

      var rect = moreListEl.getBoundingClientRect();
      if (rect.bottom <= window.innerHeight + 300){
        renderMoreBatch();
      }
    }, { passive:true });
  }

  function isMobile(){
    return window.matchMedia && window.matchMedia("(max-width: 760px)").matches;
  }

  function renderHome(){
    var container = document.getElementById("news-container");
    container.innerHTML = "";

    var categories = homepageData.categories || {};
    var all = homepageData.all || [];

    function renderHeroLike(title, items, viewAllHref, chipLabel, sideCount){
      items = sortNewestFirst(items || []);
      if (!items.length) return null;

      var main = pickFirstWithImage(items);
      if (!main) return null;

      var candidates = items.filter(function(x){ return main ? x.id !== main.id : true; });
      candidates = sortNewestFirst(candidates);

      var withImg = candidates.filter(hasImage);
      var noImg = candidates.filter(function(x){ return !hasImage(x); });

      var sideItems = take(withImg.concat(noImg), sideCount);

      var wrap = document.createElement("div");
      wrap.innerHTML = sectionHeader(title, viewAllHref);

      var grid = document.createElement("div");
      grid.className = "hero-grid";

      var mainCard = document.createElement("div");
      mainCard.className = "card hero-main";

      var mainImg = pickImage(main);
      var mainTime = formatTime(safeTime(main));

      mainCard.innerHTML =
        '<div class="img">' + (mainImg ? '<img loading="eager" fetchpriority="high" decoding="async" width="1200" height="675" src="' + mainImg + '" alt="' + escapeHtml(main.title) + '">' : '') + '</div>' +
        '<div class="body">' +
          '<div class="kicker">' +
            '<span class="chip">' + escapeHtml(chipLabel || title) + '</span>' +
            '<span>' + escapeHtml(mainTime) + '</span>' +
          '</div>' +
          '<h3 class="hero-title"><a href="' + linkToArticle(main) + '">' + escapeHtml(main.title) + '</a></h3>' +
        '</div>';

      var sideCol = document.createElement("div");
      sideCol.className = "hero-side";

      if (!sideItems.length){
        var empty = document.createElement("div");
        empty.className = "side-item";
        empty.innerHTML = '<div class="side-thumb"></div><div><p class="side-title">No more headlines yet.</p></div>';
        sideCol.appendChild(empty);
      } else {
        sideItems.forEach(function(a){
          var img = pickImage(a);
          var t = formatTime(safeTime(a));
          var div = document.createElement("div");
          div.className = "side-item";
          div.innerHTML =
            '<div class="side-thumb">' + (img ? '<img loading="lazy" decoding="async" width="172" height="128" src="' + img + '" alt="' + escapeHtml(a.title) + '">' : '') + '</div>' +
            '<div>' +
              '<p class="side-title"><a href="' + linkToArticle(a) + '">' + escapeHtml(a.title) + '</a></p>' +
              '<div class="meta">' + escapeHtml(t) + '</div>' +
            '</div>';
          sideCol.appendChild(div);
        });
      }

      grid.appendChild(mainCard);
      grid.appendChild(sideCol);
      wrap.appendChild(grid);
      return wrap;
    }

    var top = categories["top headlines"] || categories["Top Headlines"] || [];
    var heroMain = pickFirstWithImage(top) || pickFirstWithImage(all);

    var heroSideCandidates = top.filter(function(x){ return heroMain ? x.id !== heroMain.id : true; });
    heroSideCandidates = sortNewestFirst(heroSideCandidates);

    var sideWithImg = heroSideCandidates.filter(hasImage);
    var sideNoImg = heroSideCandidates.filter(function(x){ return !hasImage(x); });

    var heroSideCount = isMobile() ? 4 : 6;
    var heroSideItems = take(sideWithImg.concat(sideNoImg), heroSideCount);

    var heroWrap = document.createElement("div");
    heroWrap.innerHTML = sectionHeader("Top Headlines", "/category/top-headlines.html");

    var heroGrid = document.createElement("div");
    heroGrid.className = "hero-grid";

    var mainCard = document.createElement("div");
    mainCard.className = "card hero-main";

    var mainImg = heroMain ? pickImage(heroMain) : null;
    var mainTime = heroMain ? formatTime(safeTime(heroMain)) : "";

    mainCard.innerHTML =
      '<div class="img">' + (mainImg ? '<img loading="eager" fetchpriority="high" decoding="async" width="1200" height="675" src="' + mainImg + '" alt="' + escapeHtml(heroMain.title) + '">' : '') + '</div>' +
      '<div class="body">' +
        '<div class="kicker">' +
          '<span class="chip">Top</span>' +
          '<span>' + escapeHtml(mainTime) + '</span>' +
        '</div>' +
        '<h3 class="hero-title"><a href="' + (heroMain ? linkToArticle(heroMain) : '#') + '">' + escapeHtml(heroMain ? heroMain.title : 'No headline yet') + '</a></h3>' +
        '<p class="hero-desc">' + escapeHtml(heroMain && heroMain.summary ? stripHtml(heroMain.summary) : '') + '</p>' +
      '</div>';

    var sideCol = document.createElement("div");
    sideCol.className = "hero-side";

    if (!heroSideItems.length){
      var empty = document.createElement("div");
      empty.className = "side-item";
      empty.innerHTML = '<div class="side-thumb"></div><div><p class="side-title">No more headlines yet.</p></div>';
      sideCol.appendChild(empty);
    } else {
      heroSideItems.forEach(function(a){
        var img = pickImage(a);
        var t = formatTime(safeTime(a));
        var div = document.createElement("div");
        div.className = "side-item";
        div.innerHTML =
          '<div class="side-thumb">' + (img ? '<img loading="lazy" decoding="async" width="172" height="128" src="' + img + '" alt="' + escapeHtml(a.title) + '">' : '') + '</div>' +
          '<div>' +
            '<p class="side-title"><a href="' + linkToArticle(a) + '">' + escapeHtml(a.title) + '</a></p>' +
            '<div class="meta">' + escapeHtml(t) + '</div>' +
          '</div>';
        sideCol.appendChild(div);
      });
    }

    heroGrid.appendChild(mainCard);
    heroGrid.appendChild(sideCol);
    heroWrap.appendChild(heroGrid);
    container.appendChild(heroWrap);

    if (isMobile()){
      var polItems = categories["Politics"] || categories["politics"] || [];
      var polHero = renderHeroLike("Politics", polItems, "/category/politics.html", "Politics", 4);
      if (polHero) container.appendChild(polHero);

      var techItems = categories["Technology"] || categories["technology"] || [];
      var techHero = renderHeroLike("Technology", techItems, "/category/technology.html", "Tech", 4);
      if (techHero) container.appendChild(techHero);
    }

    var breaking = sortNewestFirst(categories["breaking"] || categories["Breaking"] || []);
    var breakingBlock = document.createElement("div");
    breakingBlock.innerHTML = sectionHeader("Breaking", "/category/breaking.html");

    var strip = document.createElement("div");
    strip.className = "strip";

    var breakingItems = take(breaking, 6);
    if (!breakingItems.length){
      var bEmpty = document.createElement("div");
      bEmpty.className = "strip-item";
      bEmpty.innerHTML = "<div>(no items yet)</div>";
      strip.appendChild(bEmpty);
    } else {
      breakingItems.forEach(function(a){
        var row = document.createElement("div");
        row.className = "strip-item";
        row.innerHTML =
          '<div style="flex:1">' +
            '<a href="' + linkToArticle(a) + '">' + escapeHtml(a.title) + '</a>' +
            '<div class="strip-meta">' + escapeHtml(formatTime(safeTime(a))) + '</div>' +
          '</div>';
        strip.appendChild(row);
      });
    }

    breakingBlock.appendChild(strip);
    container.appendChild(breakingBlock);

    var trending = sortNewestFirst(categories["trending"] || categories["Trending"] || []);
    var trendWrap = document.createElement("div");
    trendWrap.innerHTML = sectionHeader("Trending", "/category/trending.html");

    var rail = document.createElement("div");
    rail.className = "rail";

    var trendItems = take(trending, 12);
    if (!trendItems.length){
      var tEmpty = document.createElement("div");
      tEmpty.className = "error-box";
      tEmpty.textContent = "(no items yet)";
      trendWrap.appendChild(tEmpty);
    } else {
      trendItems.forEach(function(a){
        var img = pickImage(a);
        var t = formatTime(safeTime(a));
        var card = document.createElement("div");
        card.className = "rail-card";
        card.innerHTML =
          '<div class="thumb">' + (img ? '<img loading="lazy" decoding="async" width="520" height="300" src="' + img + '" alt="' + escapeHtml(a.title) + '">' : '') + '</div>' +
          '<div class="body">' +
            '<p class="title"><a href="' + linkToArticle(a) + '">' + escapeHtml(a.title) + '</a></p>' +
            '<div class="meta">' + escapeHtml(t) + '</div>' +
          '</div>';
        rail.appendChild(card);
      });
      trendWrap.appendChild(rail);
    }
    container.appendChild(trendWrap);

    if (!isMobile()){
      var sportsItemsHero = categories["Sports"] || categories["sports"] || [];
      var sportsHero = renderHeroLike("Sports", sportsItemsHero, "/category/sports.html", "Sports", 6);
      if (sportsHero) container.appendChild(sportsHero);
    }

    var blockCats = ["World News","Politics","General News","Technology","Sports"];
    if (isMobile()){
      blockCats = ["World News","General News","Sports"];
    } else {
      blockCats = ["World News","Politics","General News","Technology"];
    }

    var catGridWrap = document.createElement("div");
    catGridWrap.innerHTML = sectionHeader("Latest by Category");
    var catGrid = document.createElement("div");
    catGrid.className = "cat-grid";

    blockCats.forEach(function(catName){
      var items = sortNewestFirst(categories[catName] || []);
      var withImagesTop5 = pickTopWithImages(items, 5);
      var leadItem = withImagesTop5.length ? withImagesTop5[0] : null;
      var rest = withImagesTop5.length > 1 ? withImagesTop5.slice(1) : [];

      var viewAllHref = "/category/general.html";
      if (catName === "World News") viewAllHref = "/category/world.html";
      if (catName === "Politics") viewAllHref = "/category/politics.html";
      if (catName === "General News") viewAllHref = "/category/general.html";
      if (catName === "Technology") viewAllHref = "/category/technology.html";
      if (catName === "Sports") viewAllHref = "/category/sports.html";

      var block = document.createElement("div");
      block.className = "cat-block";

      var sub = document.createElement("div");
      sub.innerHTML = sectionHeader(catName, viewAllHref);
      block.appendChild(sub);

      if (leadItem){
        var img = pickImage(leadItem);
        var t = formatTime(safeTime(leadItem));
        var lead = document.createElement("div");
        lead.className = "lead";
        lead.innerHTML =
          '<div class="thumb">' + (img ? '<img loading="lazy" decoding="async" width="240" height="168" src="' + img + '" alt="' + escapeHtml(leadItem.title) + '">' : '') + '</div>' +
          '<div>' +
            '<h3><a href="' + linkToArticle(leadItem) + '">' + escapeHtml(leadItem.title) + '</a></h3>' +
            '<div class="meta">' + escapeHtml(t) + '</div>' +
          '</div>';
        block.appendChild(lead);
      } else {
        var emptyLead = document.createElement("div");
        emptyLead.className = "lead";
        emptyLead.innerHTML = "<div>(no image items yet)</div>";
        block.appendChild(emptyLead);
      }

      var list = document.createElement("div");
      list.className = "list";

      if (rest.length){
        rest.forEach(function(a){
          var img2 = pickImage(a);
          var t2 = formatTime(safeTime(a));
          var row = document.createElement("div");
          row.className = "list-row";
          row.innerHTML =
            '<div class="mini">' + (img2 ? '<img loading="lazy" decoding="async" width="112" height="84" src="' + img2 + '" alt="' + escapeHtml(a.title) + '">' : '') + '</div>' +
            '<a href="' + linkToArticle(a) + '">' + escapeHtml(a.title) + '</a>' +
            '<div class="time">' + escapeHtml(t2) + '</div>';
          list.appendChild(row);
        });
      } else {
        var noMore = document.createElement("div");
        noMore.className = "list-row";
        noMore.innerHTML = "<div>(no more image items)</div>";
        list.appendChild(noMore);
      }

      block.appendChild(list);
      catGrid.appendChild(block);
    });

    catGridWrap.appendChild(catGrid);
    container.appendChild(catGridWrap);

    var health = sortNewestFirst(categories["Health & Fitness"] || []);
    var healthWrap = document.createElement("div");
    healthWrap.innerHTML = sectionHeader("Health & Fitness", "/category/health-fitness.html");

    var healthRail = document.createElement("div");
    healthRail.className = "rail";

    var healthPrefer = health.filter(hasImage).concat(health.filter(function(x){ return !hasImage(x); }));
    var healthItems = take(healthPrefer, 12);

    if (!healthItems.length){
      var hEmpty = document.createElement("div");
      hEmpty.className = "error-box";
      hEmpty.textContent = "(no items yet)";
      healthWrap.appendChild(hEmpty);
    } else {
      healthItems.forEach(function(a){
        var img = pickImage(a);
        var t = formatTime(safeTime(a));
        var card = document.createElement("div");
        card.className = "rail-card";
        card.innerHTML =
          '<div class="thumb">' + (img ? '<img loading="lazy" decoding="async" width="520" height="300" src="' + img + '" alt="' + escapeHtml(a.title) + '">' : '') + '</div>' +
          '<div class="body">' +
            '<p class="title"><a href="' + linkToArticle(a) + '">' + escapeHtml(a.title) + '</a></p>' +
            '<div class="meta">' + escapeHtml(t) + '</div>' +
          '</div>';
        healthRail.appendChild(card);
      });
      healthWrap.appendChild(healthRail);
    }
    container.appendChild(healthWrap);

    var ent = sortNewestFirst(categories["Entertainment"] || []);
    var entWrap = document.createElement("div");
    entWrap.innerHTML = sectionHeader("Entertainment", "/category/entertainment.html");

    var textOnly = document.createElement("div");
    textOnly.className = "text-only";

    var entItems = take(ent, 6);
    if (!entItems.length){
      var eEmpty = document.createElement("div");
      eEmpty.className = "row";
      eEmpty.textContent = "(no items yet)";
      textOnly.appendChild(eEmpty);
    } else {
      entItems.forEach(function(a){
        var t = formatTime(safeTime(a));
        var row = document.createElement("div");
        row.className = "row";
        row.innerHTML =
          '<a href="' + linkToArticle(a) + '">' + escapeHtml(a.title) + '</a>' +
          '<div class="meta">' + escapeHtml(t) + '</div>';
        textOnly.appendChild(row);
      });
    }

    entWrap.appendChild(textOnly);
    container.appendChild(entWrap);

    var shown = {};
    function markShown(arr){
      arr = arr || [];
      for (var i=0;i<arr.length;i++){
        if (arr[i] && arr[i].id) shown[arr[i].id] = true;
      }
    }
    if (heroMain && heroMain.id) shown[heroMain.id] = true;
    markShown(heroSideItems);
    markShown(breakingItems);
    markShown(trendItems);

    blockCats.forEach(function(cat){
      var items2 = pickTopWithImages(categories[cat] || [], 5);
      markShown(items2);
    });

    if (isMobile()){
      var polItems2 = categories["Politics"] || categories["politics"] || [];
      markShown(take(sortNewestFirst(polItems2), 10));
      var techItems2 = categories["Technology"] || categories["technology"] || [];
      markShown(take(sortNewestFirst(techItems2), 10));
    } else {
      var sportsItems2 = categories["Sports"] || categories["sports"] || [];
      markShown(take(sortNewestFirst(sportsItems2), 10));
    }

    markShown(healthItems);
    markShown(entItems);

    var candidates = (all || []).filter(function(a){ return a && a.id && !shown[a.id]; });

    var withImg = candidates.filter(hasImage);
    var noImg = candidates.filter(function(x){ return !hasImage(x); });
    moreAll = sortNewestFirst(withImg).concat(sortNewestFirst(noImg));

    var moreWrap = document.createElement("div");
    moreWrap.className = "more-wrap";
    moreWrap.innerHTML = sectionHeader("More for you");

    moreListEl = document.createElement("div");
    moreListEl.className = "more-list";

    moreLoadingEl = document.createElement("div");
    moreLoadingEl.className = "load-hint";
    moreLoadingEl.textContent = "Scroll for more…";

    moreShown = 0;
    moreWrap.appendChild(moreListEl);
    moreWrap.appendChild(moreLoadingEl);
    container.appendChild(moreWrap);

    renderMoreBatch();
    installInfiniteScroll();
  }

  function loadHomepage(){
    var container = document.getElementById("news-container");

    var cached = readHomeCache();
    if (cached && isValidHomepage(cached)){
      homepageData = cached;
      renderHome();
    } else {
      container.innerHTML = "Loading…";
    }

    fetchJsonWithRetry(HOMEPAGE_URL, 20000, 0)
      .then(function(data){
        if (!isValidHomepage(data)){
          if (!cached) showError("Bad JSON structure.");
          return;
        }
        homepageData = data;
        writeHomeCache(data);
        renderHome();
      })
      .catch(function(err){
        console.error(err);
        if (!cached) showError(String(err && err.message ? err.message : err));
      });
  }

  function hardRefresh(){
    try{ localStorage.removeItem(HOME_CACHE_KEY); }catch(e){}
    homepageData = null;
    loadHomepage();
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  function doSearch(query){
    query = (query || "").toString().trim().toLowerCase();
    var resultsEl = document.getElementById("mobile-search-results");
    if (!resultsEl) return;

    if (!homepageData || !homepageData.all){
      resultsEl.innerHTML = '<div class="row">No data yet. Try refresh.</div>';
      return;
    }

    if (!query){
      resultsEl.innerHTML = '<div class="row">Type to search headlines.</div>';
      return;
    }

    var all = homepageData.all || [];
    var hits = [];
    for (var i=0;i<all.length;i++){
      var a = all[i];
      var title = (a && a.title) ? String(a.title).toLowerCase() : "";
      if (title.indexOf(query) !== -1) hits.push(a);
      if (hits.length >= 30) break;
    }

    if (!hits.length){
      resultsEl.innerHTML = '<div class="row">No results.</div>';
      return;
    }

    var html = "";
    hits.forEach(function(a){
      html += '<div class="row">' +
        '<a href="' + linkToArticle(a) + '">' + escapeHtml(a.title) + '</a>' +
        '<div class="meta">' + escapeHtml(formatTime(safeTime(a))) + '</div>' +
      '</div>';
    });
    resultsEl.innerHTML = html;
  }

  function openSheet(mode){
    var overlay = document.getElementById("sheet-overlay");
    var title = document.getElementById("sheet-title");
    var searchBox = document.getElementById("sheet-search");
    var settingsBox = document.getElementById("sheet-settings");

    if (!overlay || !title || !searchBox || !settingsBox) return;

    if (mode === "search"){
      title.textContent = "Search";
      searchBox.style.display = "block";
      settingsBox.style.display = "none";

      var input = document.getElementById("mobile-search-input");
      var results = document.getElementById("mobile-search-results");
      if (results) results.innerHTML = '<div class="row">Type to search headlines.</div>';
      if (input){
        input.value = "";
        setTimeout(function(){ input.focus(); }, 50);
      }
    } else {
      title.textContent = "Settings";
      searchBox.style.display = "none";
      settingsBox.style.display = "block";
    }

    overlay.style.display = "flex";
    overlay.setAttribute("aria-hidden", "false");
  }

  function closeSheet(){
    var overlay = document.getElementById("sheet-overlay");
    if (!overlay) return;
    overlay.style.display = "none";
    overlay.setAttribute("aria-hidden", "true");
  }

  function getToken(){
    try { return localStorage.getItem(ACCESS_KEY) || ""; } catch(e){ return ""; }
  }
  function isLoggedIn(){
    return !!getToken();
  }
  function setLoggedOut(){
    try{
      localStorage.removeItem(ACCESS_KEY);
      localStorage.removeItem(USER_EMAIL_KEY);
    }catch(e){}
    refreshAuthUI();
  }
  function refreshAuthUI(){
    var btnSignin = document.getElementById("btn-signin");
    var btnAccount = document.getElementById("btn-account");
    var emailEl = document.getElementById("account-email");

    var sheetSignin = document.getElementById("btn-sheet-signin");
    var sheetAccount = document.getElementById("btn-sheet-account");

    var logged = isLoggedIn();
    if (btnSignin) btnSignin.style.display = logged ? "none" : "inline-flex";
    if (btnAccount) btnAccount.style.display = logged ? "inline-flex" : "none";

    if (sheetSignin) sheetSignin.style.display = logged ? "none" : "inline-flex";
    if (sheetAccount) sheetAccount.style.display = logged ? "inline-flex" : "none";

    var email = "";
    try { email = localStorage.getItem(USER_EMAIL_KEY) || ""; } catch(e){}
    if (!email) email = "(email not set yet)";
    if (emailEl) emailEl.textContent = email;
  }

  function openAccountModal(){
    var overlay = document.getElementById("account-modal");
    if (overlay) overlay.style.display = "flex";
  }
  function closeAccountModal(){
    var overlay = document.getElementById("account-modal");
    if (overlay) overlay.style.display = "none";
  }

  function setupAuthUI(){
    var btnSignin = document.getElementById("btn-signin");
    var btnAccount = document.getElementById("btn-account");
    var btnLogout = document.getElementById("btn-logout");
    var btnClose = document.getElementById("account-close");
    var overlay = document.getElementById("account-modal");

    var sheetSignin = document.getElementById("btn-sheet-signin");
    var sheetAccount = document.getElementById("btn-sheet-account");

    // ✅ FIX: send user to the real login page in /auth/
    if (btnSignin){
      btnSignin.addEventListener("click", function(){
        window.location.href = basePath() + "/auth/login.html";
      });
    }
    if (sheetSignin){
      sheetSignin.addEventListener("click", function(){
        window.location.href = basePath() + "/auth/login.html";
      });
    }

    if (btnAccount){
      btnAccount.addEventListener("click", function(){
        refreshAuthUI();
        openAccountModal();
      });
    }
    if (sheetAccount){
      sheetAccount.addEventListener("click", function(){
        refreshAuthUI();
        closeSheet();
        openAccountModal();
      });
    }

    if (btnLogout){
      btnLogout.addEventListener("click", function(){
        setLoggedOut();
        closeAccountModal();
      });
    }

    if (btnClose) btnClose.addEventListener("click", closeAccountModal);

    if (overlay){
      overlay.addEventListener("click", function(e){
        if (e.target === overlay) closeAccountModal();
      });
    }

    window.addEventListener("keydown", function(e){
      if (e.key === "Escape") closeAccountModal();
    });

    refreshAuthUI();
  }

  function setupMenu(){
    var burger = document.getElementById("hamburger");
    var menu = document.getElementById("menu");

    function closeMenu(){
      if (!menu || !burger) return;
      menu.style.display = "none";
      burger.setAttribute("aria-expanded", "false");
    }
    function toggleMenu(){
      if (!menu || !burger) return;
      var open = (menu.style.display === "block");
      if (open){
        closeMenu();
      } else {
        menu.style.display = "block";
        burger.setAttribute("aria-expanded", "true");
      }
    }

    if (burger) burger.addEventListener("click", function(e){
      e.stopPropagation();
      toggleMenu();
    });

    document.addEventListener("click", function(){
      closeMenu();
    });

    if (menu) menu.addEventListener("click", function(e){
      e.stopPropagation();
    });

    window.addEventListener("keydown", function(e){
      if (e.key === "Escape") closeMenu();
    });
  }

  function setupDesktopActions(){
    var btnSearch = document.getElementById("btn-desktop-search");
    var btnRefresh = document.getElementById("btn-desktop-refresh");

    if (btnRefresh){
      btnRefresh.addEventListener("click", function(){
        hardRefresh();
      });
    }

    if (btnSearch){
      btnSearch.addEventListener("click", function(){
        var q = window.prompt("Search headlines:");
        if (q === null) return;
        q = String(q || "").trim();
        if (!q) return;
        if (!homepageData || !homepageData.all) return;
        var all = homepageData.all || [];
        var ql = q.toLowerCase();
        for (var i=0;i<all.length;i++){
          var a = all[i];
          var title = (a && a.title) ? String(a.title).toLowerCase() : "";
          if (title.indexOf(ql) !== -1){
            window.location.href = linkToArticle(a);
            return;
          }
        }
        window.alert("No results.");
      });
    }
  }

  function setupMobileTabs(){
    var tabHome = document.getElementById("tab-home");
    var tabRefresh = document.getElementById("tab-refresh");
    var tabSearch = document.getElementById("tab-search");
    var tabSettings = document.getElementById("tab-settings");

    function setActive(tabEl){
      [tabHome, tabRefresh, tabSearch, tabSettings].forEach(function(t){
        if (!t) return;
        t.classList.remove("active");
      });
      if (tabEl) tabEl.classList.add("active");
    }

    if (tabHome){
      tabHome.addEventListener("click", function(){
        setActive(tabHome);
        closeSheet();
        window.scrollTo({ top: 0, behavior: "smooth" });
      });
    }

    if (tabRefresh){
      tabRefresh.addEventListener("click", function(){
        setActive(tabRefresh);
        closeSheet();
        hardRefresh();
      });
    }

    if (tabSearch){
      tabSearch.addEventListener("click", function(){
        setActive(tabSearch);
        openSheet("search");
      });
    }

    if (tabSettings){
      tabSettings.addEventListener("click", function(){
        setActive(tabSettings);
        refreshAuthUI();
        openSheet("settings");
      });
    }

    var sheetClose = document.getElementById("sheet-close");
    var sheetOverlay = document.getElementById("sheet-overlay");
    if (sheetClose) sheetClose.addEventListener("click", closeSheet);
    if (sheetOverlay){
      sheetOverlay.addEventListener("click", function(e){
        if (e.target === sheetOverlay) closeSheet();
      });
    }

    var input = document.getElementById("mobile-search-input");
    if (input){
      input.addEventListener("input", function(){
        doSearch(input.value);
      });
      input.addEventListener("keydown", function(e){
        if (e.key === "Enter"){
          doSearch(input.value);
        }
      });
    }

    window.addEventListener("keydown", function(e){
      if (e.key === "Escape") closeSheet();
    });
  }

  setupMenu();
  setupAuthUI();
  setupDesktopActions();
  setupMobileTabs();
  loadHomepage();
})();
</script>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5368831813847678"
     crossorigin="anonymous"></script>

</body>
</html>

